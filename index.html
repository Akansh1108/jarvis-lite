<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Automation OS ‚Äî Sign In</title>
<meta name="theme-color" content="#0a0f1c" />
<style>
  :root{--bg:#050914;--panel:#0b1222;--ink:#e6eefc;--muted:#94a3b8;--brand:#6ee7ff;--accent:#7c3aed;--edge:#1e293b}
  *{box-sizing:border-box}
  html,body{margin:0;height:100%;background:linear-gradient(180deg,#050914,#0a1020);color:var(--ink);font:15px/1.4 system-ui,-apple-system,Segoe UI,Inter,Roboto,Arial}
  a{color:var(--brand);text-decoration:none}
  .wrap{max-width:1120px;margin:0 auto;padding:24px}
  header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
  .logo{display:flex;gap:12px;align-items:center}
  .orb{width:36px;height:36px;border-radius:50%;background:radial-gradient(circle at 30% 30%,#7df,#58a 60%,#1b2b4a 100%);box-shadow:0 0 24px #07f6}
  .btn{background:linear-gradient(135deg,#14213a,#0b1222);border:1px solid var(--edge);color:#eaf2ff;padding:10px 14px;border-radius:10px;cursor:pointer}
  .btn:hover{border-color:#334155;transform:translateY(-1px)}
  .btn.brand{background:linear-gradient(135deg,#0ea5e9,#7c3aed);border:none}
  .muted{color:var(--muted)}
  .panel{background:rgba(15,23,42,.6);border:1px solid var(--edge);border-radius:16px;padding:16px}
  input{width:100%;background:#0b1222;border:1px solid #25324a;color:#eaf2ff;padding:10px 12px;border-radius:10px}
  label{display:block;margin:8px 0 6px;color:#cbd5e1}
  .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:16px}
  .hidden{display:none!important}
  /* Landing hero */
  .hero{display:grid;grid-template-columns:1.2fr .8fr;gap:18px;align-items:start}
  @media(max-width:920px){.hero{grid-template-columns:1fr}}
  .heroCard{padding:24px;border-radius:16px;background:
    radial-gradient(1200px 200px at 10% -10%,rgba(124,58,237,.18),transparent 60%),
    radial-gradient(1000px 250px at 110% -20%,rgba(14,165,233,.15),transparent 60%),
    linear-gradient(180deg,#091227,#0a1020);border:1px solid var(--edge)}
  .title{font-size:28px;margin:4px 0 8px}
  .subtitle{color:var(--muted)}
  .kpi{display:flex;gap:10px;flex-wrap:wrap;margin-top:8px}
  .bubble{background:#0b1222;border:1px solid var(--edge);border-radius:12px;padding:10px 12px}
  /* App shell */
  .app{display:grid;grid-template-columns:260px 1fr;gap:16px}
  @media(max-width:920px){.app{grid-template-columns:1fr}}
  .sidebar{position:sticky;top:16px;height:calc(100vh - 64px)}
  .nav a{display:flex;gap:10px;align-items:center;padding:10px 12px;border-radius:10px;border:1px solid transparent;color:#e2e8f0}
  .nav a.active,.nav a:hover{background:#0b1222;border-color:#25324a}
  .content{min-height:60vh}
  .row{display:flex;gap:10px;flex-wrap:wrap}
  .pill{padding:6px 10px;border:1px solid var(--edge);border-radius:999px}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="logo"><div class="orb" aria-hidden="true"></div><strong>Automation OS</strong></div>
    <div class="row">
      <button id="toAppBtn" class="btn hidden">Open Console</button>
      <button id="signOutBtn" class="btn hidden">Sign Out</button>
    </div>
  </header>

  <!-- ========== LANDING PAGE ========== -->
  <section id="landing">
    <div class="hero">
      <div class="heroCard">
        <div class="title">Welcome to your <strong>Automation Command Center</strong></div>
        <p class="subtitle">Buy templates, deploy AI automations, scale across teams. Sign in to begin.</p>
        <div class="kpi">
          <div class="bubble">Templates: <strong>120+</strong></div>
          <div class="bubble">Integrations: <strong>50+</strong></div>
          <div class="bubble">Avg setup time: <strong>&lt; 3 min</strong></div>
        </div>
      </div>

      <div class="panel">
        <h3 style="margin:0 0 8px">Sign in / Create account</h3>
        <p class="muted" style="margin:0 0 10px">Choose email & password or continue with Google.</p>

        <!-- Tabs -->
        <div class="row" style="margin-bottom:10px">
          <button id="tabSignIn" class="btn brand">Sign in</button>
          <button id="tabSignUp" class="btn">Create account</button>
        </div>

        <!-- Sign In form -->
        <form id="signInForm">
          <label for="siEmail">Email</label>
          <input id="siEmail" type="email" placeholder="you@company.com" autocomplete="email" required />
          <label for="siPass">Password</label>
          <input id="siPass" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password" required />
          <div class="row" style="margin-top:12px">
            <button type="submit" class="btn brand">Sign in</button>
            <button id="googleIn" type="button" class="btn">Continue with Google</button>
            <button id="resetPass" type="button" class="btn">Forgot password</button>
          </div>
        </form>

        <!-- Sign Up form -->
        <form id="signUpForm" class="hidden" autocomplete="on">
          <label for="suName">Name</label>
          <input id="suName" type="text" placeholder="Your name" autocomplete="name" required />
          <label for="suEmail">Email</label>
          <input id="suEmail" type="email" placeholder="you@company.com" autocomplete="email" required />
          <label for="suPass">Password</label>
          <input id="suPass" type="password" placeholder="At least 6 characters" autocomplete="new-password" required />
          <div class="row" style="margin-top:12px">
            <button type="submit" class="btn brand">Create account</button>
            <button id="googleUp" type="button" class="btn">Sign up with Google</button>
          </div>
        </form>

        <p id="authMsg" class="muted" style="margin-top:10px"></p>
      </div>
    </div>
  </section>

  <!-- ========== APP SHELL ========== -->
  <section id="app" class="app hidden" aria-live="polite">
    <aside class="sidebar panel">
      <div style="display:flex;align-items:center;gap:10px;margin-bottom:10px">
        <div class="orb" style="width:28px;height:28px"></div>
        <div>
          <div id="helloName" style="font-weight:600">Hello</div>
          <div id="helloEmail" class="muted" style="font-size:12px">‚Äî</div>
        </div>
      </div>
      <nav class="nav" id="nav">
        <a href="#/dashboard" data-route="dashboard" class="active">üìä Dashboard</a>
        <a href="#/settings" data-route="settings">‚öôÔ∏è Settings</a>
        <a href="#/profile" data-route="profile">üë§ Profile</a>
      </nav>
      <div style="margin-top:12px">
        <span id="planTag" class="pill">Plan: Free</span>
      </div>
      <div style="margin-top:12px">
        <button id="goBilling" class="btn" style="width:100%">Upgrade</button>
      </div>
    </aside>

    <main class="content">
      <!-- DASHBOARD -->
      <div id="view-dashboard" class="panel">
        <h3 style="margin-top:0">Dashboard</h3>
        <p class="muted">Quick stats for your automations.</p>
        <div class="grid" style="grid-template-columns:repeat(12,1fr);gap:12px">
          <div class="panel" style="grid-column:span 4">
            <div>Active automations</div>
            <div id="kpiActive" style="font-size:28px;margin-top:6px">0</div>
          </div>
          <div class="panel" style="grid-column:span 4">
            <div>Success rate (24h)</div>
            <div id="kpiSR" style="font-size:28px;margin-top:6px">‚Äì</div>
          </div>
          <div class="panel" style="grid-column:span 4">
            <div>Tokens used (24h)</div>
            <div id="kpiTok" style="font-size:28px;margin-top:6px">‚Äì</div>
          </div>
        </div>
      </div>

      <!-- SETTINGS -->
      <div id="view-settings" class="panel hidden">
        <h3 style="margin-top:0">Settings</h3>
        <p class="muted">Manage plan and security.</p>
        <div class="row" style="margin-top:8px">
          <button id="sendPwdReset" class="btn">Send password reset email</button>
          <button id="rotateSession" class="btn">Refresh session</button>
        </div>
      </div>

      <!-- PROFILE -->
      <div id="view-profile" class="panel hidden">
        <h3 style="margin-top:0">Profile</h3>
        <form id="profileForm" style="max-width:520px">
          <label for="pfName">Name</label>
          <input id="pfName" type="text" required />
          <label for="pfEmail">Email (read-only)</label>
          <input id="pfEmail" type="email" disabled />
          <div class="row" style="margin-top:12px">
            <button type="submit" class="btn brand">Save</button>
          </div>
        </form>
      </div>
    </main>
  </section>
</div>

<!-- Supabase JS -->
<script src="https://unpkg.com/@supabase/supabase-js@2.46.1/dist/umd/supabase.js" crossorigin="anonymous"></script>
<script>
/* =========================
   CONFIG (replace these)
   ========================= */
const SUPABASE_URL = "https://YOUR_PROJECT_ID.supabase.co";   // ‚Üê replace
const SUPABASE_ANON_KEY = "YOUR_SUPABASE_ANON_KEY";           // ‚Üê replace

const sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY, {
  auth: { persistSession: true, flowType: "pkce" }
});

/* =========================
   ELEMENTS
   ========================= */
const landing = document.getElementById('landing');
const app = document.getElementById('app');
const toAppBtn = document.getElementById('toAppBtn');
const signOutBtn = document.getElementById('signOutBtn');
const authMsg = document.getElementById('authMsg');
const planTag = document.getElementById('planTag');

const tabSignIn = document.getElementById('tabSignIn');
const tabSignUp = document.getElementById('tabSignUp');
const signInForm = document.getElementById('signInForm');
const signUpForm = document.getElementById('signUpForm');

const siEmail = document.getElementById('siEmail');
const siPass = document.getElementById('siPass');
const suName = document.getElementById('suName');
const suEmail = document.getElementById('suEmail');
const suPass = document.getElementById('suPass');

const googleIn = document.getElementById('googleIn');
const googleUp = document.getElementById('googleUp');
const resetPass = document.getElementById('resetPass');

const helloName = document.getElementById('helloName');
const helloEmail = document.getElementById('helloEmail');
const nav = document.getElementById('nav');

const viewDashboard = document.getElementById('view-dashboard');
const viewSettings = document.getElementById('view-settings');
const viewProfile = document.getElementById('view-profile');

const kpiActive = document.getElementById('kpiActive');
const kpiSR = document.getElementById('kpiSR');
const kpiTok = document.getElementById('kpiTok');

const profileForm = document.getElementById('profileForm');
const pfName = document.getElementById('pfName');
const pfEmail = document.getElementById('pfEmail');

const goBilling = document.getElementById('goBilling');

let sessionUser = null;
let currentPlan = 'Free';

/* =========================
   VIEW HELPERS
   ========================= */
function showLanding(){ landing.classList.remove('hidden'); app.classList.add('hidden'); toAppBtn.classList.add('hidden'); signOutBtn.classList.add('hidden'); }
function showApp(){ landing.classList.add('hidden'); app.classList.remove('hidden'); toAppBtn.classList.add('hidden'); signOutBtn.classList.remove('hidden'); }

function setRoute(route){
  document.querySelectorAll('.nav a').forEach(a=>{
    a.classList.toggle('active', a.dataset.route === route);
  });
  [viewDashboard, viewSettings, viewProfile].forEach(v => v.classList.add('hidden'));
  if(route==='dashboard') viewDashboard.classList.remove('hidden');
  if(route==='settings') viewSettings.classList.remove('hidden');
  if(route==='profile') viewProfile.classList.remove('hidden');
}

window.addEventListener('hashchange', () => {
  const route = window.location.hash.replace('#/','') || 'dashboard';
  setRoute(route);
});

/* =========================
   AUTH: SIGN UP / SIGN IN
   ========================= */
tabSignIn.addEventListener('click', ()=>{
  tabSignIn.classList.add('brand'); tabSignUp.classList.remove('brand');
  signInForm.classList.remove('hidden'); signUpForm.classList.add('hidden'); authMsg.textContent='';
});
tabSignUp.addEventListener('click', ()=>{
  tabSignUp.classList.add('brand'); tabSignIn.classList.remove('brand');
  signUpForm.classList.remove('hidden'); signInForm.classList.add('hidden'); authMsg.textContent='';
});

signUpForm.addEventListener('submit', async (e)=>{
  e.preventDefault();
  authMsg.textContent = "Creating account‚Ä¶";
  const name = suName.value.trim();
  const email = suEmail.value.trim();
  const password = suPass.value;

  try{
    const { data, error } = await sb.auth.signUp({ email, password });
    if(error) throw error;

    // Upsert profile (store name + email; password is managed securely by Supabase Auth)
    const userId = data.user?.id;
    if(userId){
      await sb.from('profiles').upsert({ id: userId, name, email, plan: 'Free' });
    }

    authMsg.textContent = "Account created. Check your inbox to confirm (if email confirm is on).";
  }catch(err){
    authMsg.textContent = "Error: " + err.message;
  }
});

signInForm.addEventListener('submit', async (e)=>{
  e.preventDefault();
  authMsg.textContent = "Signing in‚Ä¶";
  try{
    const { data, error } = await sb.auth.signInWithPassword({ email: siEmail.value.trim(), password: siPass.value });
    if(error) throw error;
    authMsg.textContent = "Signed in. Opening console‚Ä¶";
    await bootAfterAuth();
  }catch(err){
    authMsg.textContent = "Error: " + err.message;
  }
});

googleIn.addEventListener('click', async ()=>{
  await sb.auth.signInWithOAuth({ provider:'google', options:{ redirectTo: window.location.origin }});
});
googleUp.addEventListener('click', async ()=>{
  await sb.auth.signInWithOAuth({ provider:'google', options:{ redirectTo: window.location.origin }});
});

resetPass.addEventListener('click', async ()=>{
  const email = siEmail.value.trim();
  if(!email){ authMsg.textContent="Enter your email first."; return; }
  const { error } = await sb.auth.resetPasswordForEmail(email, { redirectTo: window.location.origin + '/#reset' });
  authMsg.textContent = error ? ("Error: " + error.message) : "Reset link sent. Check your email.";
});

/* =========================
   SESSION & PROFILE
   ========================= */
sb.auth.onAuthStateChange(async (_evt, session) => {
  sessionUser = session?.user ?? null;
  if(sessionUser){
    await bootAfterAuth();
  }else{
    showLanding();
  }
});

async function bootAfterAuth(){
  // Load profile (and create if missing for OAuth users)
  const uid = sessionUser.id;
  let { data: prof, error } = await sb.from('profiles').select('name,email,plan').eq('id', uid).maybeSingle();
  if(error){ console.warn(error); }
  if(!prof){
    const email = sessionUser.email || '';
    await sb.from('profiles').upsert({ id: uid, name: sessionUser.user_metadata?.name || 'User', email, plan:'Free' });
    prof = { name: sessionUser.user_metadata?.name || 'User', email, plan:'Free' };
  }

  currentPlan = prof.plan || 'Free';
  planTag.textContent = "Plan: " + currentPlan;

  // Header buttons
  toAppBtn.classList.add('hidden');
  signOutBtn.classList.remove('hidden');

  // Fill sidebar header
  helloName.textContent = prof.name || 'User';
  helloEmail.textContent = prof.email || (sessionUser.email ?? '‚Äî');

  // Fake KPIs (stub your analytics later)
  kpiActive.textContent = Math.floor(Math.random()*4);
  kpiSR.textContent = (90 + Math.floor(Math.random()*9)) + "%";
  kpiTok.textContent = (50 + Math.floor(Math.random()*200)) + "k";

  // Prefill profile form
  pfName.value = prof.name || '';
  pfEmail.value = prof.email || (sessionUser.email ?? '');

  showApp();
  setRoute((location.hash.replace('#/','')) || 'dashboard');
}

signOutBtn.addEventListener('click', async ()=>{
  await sb.auth.signOut();
  sessionUser = null;
  showLanding();
});

/* =========================
   PROFILE / SETTINGS
   ========================= */
profileForm.addEventListener('submit', async (e)=>{
  e.preventDefault();
  if(!sessionUser) return;
  const name = pfName.value.trim();
  const { error } = await sb.from('profiles').update({ name }).eq('id', sessionUser.id);
  alert(error ? ("Update failed: " + error.message) : "Profile updated.");
});

document.getElementById('sendPwdReset').addEventListener('click', async ()=>{
  if(!sessionUser?.email){ alert("No email on file."); return; }
  const { error } = await sb.auth.resetPasswordForEmail(sessionUser.email, { redirectTo: window.location.origin + "/#/reset" });
  alert(error ? ("Error: " + error.message) : "Reset link sent to " + sessionUser.email);
});

document.getElementById('rotateSession').addEventListener('click', async ()=>{
  const { data, error } = await sb.auth.refreshSession();
  alert(error ? ("Session refresh failed: " + error.message) : "Session refreshed.");
});

goBilling.addEventListener('click', ()=>{
  // Replace with your Stripe Checkout route
  window.location.href = "/billing";
});

/* =========================
   INITIAL BOOT
   ========================= */
(async function boot(){
  const { data:{session} } = await sb.auth.getSession();
  sessionUser = session?.user ?? null;
  if(sessionUser){ await bootAfterAuth(); } else { showLanding(); }
})();
</script>

<!--
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Supabase SQL ‚Äî run in Supabase SQL editor

-- Public profiles (store email + name + plan; DO NOT store plaintext passwords)
create table if not exists public.profiles (
  id uuid primary key references auth.users(id) on delete cascade,
  email text,
  name text,
  plan text not null default 'Free',
  updated_at timestamp with time zone default now()
);
alter table public.profiles enable row level security;
create policy "read own profile" on public.profiles for select using (auth.uid() = id);
create policy "insert own profile" on public.profiles for insert with check (auth.uid() = id);
create policy "update own profile" on public.profiles for update using (auth.uid() = id);

-- Optional: runs table for usage tracking
create table if not exists public.runs (
  id bigserial primary key,
  user_id uuid references auth.users(id) on delete cascade,
  template_id text,
  status integer,
  meta jsonb,
  created_at timestamp with time zone default now()
);
alter table public.runs enable row level security;
create policy "read own runs" on public.runs for select using (auth.uid() = user_id);
create policy "insert own runs" on public.runs for insert with check (auth.uid() = user_id);

Notes:
‚Ä¢ Passwords are handled by Supabase Auth (bcrypt). Storing them yourself is a security risk.
‚Ä¢ To ‚Äútrack usage,‚Äù join runs.user_id ‚Üí profiles/id or auth.users/id.
‚Ä¢ Enable Google in Auth ‚Üí Providers. Set redirect to your Vercel domain.
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
-->
</body>
</html>
