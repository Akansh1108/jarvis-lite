<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Automation OS – Sign In</title>
  <style>
    body { margin:0; font-family:system-ui, -apple-system, 'Segoe UI', Inter, Roboto, sans-serif;
           background:linear-gradient(180deg,#050914,#0a1020); color:#e6eefc; }
    .container { max-width:900px; margin:0 auto; padding:30px; }
    .panel { background:rgba(15,23,42,.8); border:1px solid #1e293b; border-radius:16px; padding:24px; }
    input,button { width:100%; padding:10px; margin:6px 0; border-radius:8px; border:1px solid #25324a; font-size:15px; }
    input { background:#0b1222; color:#e6eefc; }
    button { background:linear-gradient(135deg,#0ea5e9,#7c3aed); color:#fff; border:none; cursor:pointer; }
    button:hover { opacity:0.9; }
    .hidden{display:none;}
    h1{font-size:26px;margin-bottom:6px;}
    h3{margin-top:0;}
  </style>
</head>
<body>
  <div class="container">
    <h1>Welcome to your Automation Command Center</h1>
    <p>Sign in or create your account to access your dashboard.</p>

    <div class="panel">
      <div id="auth">
        <button id="tabSignIn">Sign In</button>
        <button id="tabSignUp">Sign Up</button>

        <form id="signInForm">
          <input id="siEmail" type="email" placeholder="Email" required />
          <input id="siPass" type="password" placeholder="Password" required />
          <button type="submit">Sign In</button>
          <button type="button" id="googleIn">Continue with Google</button>
        </form>

        <form id="signUpForm" class="hidden">
          <input id="suName" type="text" placeholder="Full Name" required />
          <input id="suEmail" type="email" placeholder="Email" required />
          <input id="suPass" type="password" placeholder="Password" required />
          <button type="submit">Create Account</button>
          <button type="button" id="googleUp">Sign up with Google</button>
        </form>

        <p id="authMsg"></p>
      </div>

      <div id="app" class="hidden">
        <h3>Dashboard</h3>
        <p id="welcome"></p>
        <button id="signOutBtn">Sign Out</button>
      </div>
    </div>
  </div>

  <!-- Supabase -->
  <script src="https://unpkg.com/@supabase/supabase-js@2.46.1/dist/umd/supabase.js" crossorigin="anonymous"></script>
  <script>
  // ====== CONFIG ======
  const SUPABASE_URL = "https://tqkixrssdwucgmgubbpm.supabase.co";
  const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRxa2l4cnNzZHd1Y2dtZ3ViYnBtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA4NDkwMzgsImV4cCI6MjA3NjQyNTAzOH0.rcCNkdNhpvX34Dwg105QZ-BeaJ1oy2Wvp4MhY6akwcA";

  const sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY, { auth: { persistSession: true, flowType: "pkce" } });

  // ====== ELEMENTS ======
  const tabSignIn = document.getElementById('tabSignIn');
  const tabSignUp = document.getElementById('tabSignUp');
  const signInForm = document.getElementById('signInForm');
  const signUpForm = document.getElementById('signUpForm');
  const googleIn = document.getElementById('googleIn');
  const googleUp = document.getElementById('googleUp');
  const signOutBtn = document.getElementById('signOutBtn');
  const authMsg = document.getElementById('authMsg');
  const app = document.getElementById('app');
  const auth = document.getElementById('auth');
  const welcome = document.getElementById('welcome');

  // ====== TAB SWITCH ======
  tabSignIn.onclick = () => { signInForm.classList.remove('hidden'); signUpForm.classList.add('hidden'); authMsg.textContent=''; };
  tabSignUp.onclick = () => { signUpForm.classList.remove('hidden'); signInForm.classList.add('hidden'); authMsg.textContent=''; };

  // ====== SIGN UP ======
  signUpForm.onsubmit = async (e) => {
    e.preventDefault();
    authMsg.textContent = "Creating account…";
    const { data, error } = await sb.auth.signUp({
      email: suEmail.value.trim(),
      password: suPass.value
    });
    if (error) authMsg.textContent = error.message;
    else if (!data.session) authMsg.textContent = "Check your email to confirm, then sign in.";
    else authMsg.textContent = "Account created. Redirecting...";
  };

  // ====== SIGN IN ======
  signInForm.onsubmit = async (e) => {
    e.preventDefault();
    authMsg.textContent = "Signing in…";
    const { data, error } = await sb.auth.signInWithPassword({
      email: siEmail.value.trim(),
      password: siPass.value
    });
    if (error) authMsg.textContent = error.message;
    else authMsg.textContent = "Welcome back!";
  };

  // ====== GOOGLE OAUTH ======
  googleIn.onclick = googleUp.onclick = async () => {
    await sb.auth.signInWithOAuth({
      provider: 'google',
      options: { redirectTo: window.location.origin }
    });
  };

  // ====== SESSION HANDLER ======
  sb.auth.onAuthStateChange(async (_evt, session) => {
    if (session?.user) {
      const u = session.user;
      app.classList.remove('hidden');
      auth.classList.add('hidden');
      welcome.textContent = `Hello, ${u.email}!`;
    } else {
      app.classList.add('hidden');
      auth.classList.remove('hidden');
    }
  });

  signOutBtn.onclick = async () => { await sb.auth.signOut(); };

  // ====== INITIAL BOOT ======
  (async () => {
    try {
      const r = await fetch(SUPABASE_URL + "/auth/v1/health");
      if (!r.ok && r.status !== 401) console.warn("⚠️ Health endpoint returned:", r.status);
      const { data: { session } } = await sb.auth.getSession();
      if (session?.user) {
        app.classList.remove('hidden');
        auth.classList.add('hidden');
        welcome.textContent = `Hello, ${session.user.email}!`;
      }
    } catch (err) { console.warn(err); }
  })();
  </script>

  <!--
  ✅ To verify Supabase configuration:
  1. Dashboard → Settings → API → copy Project URL & anon public key
  2. Authentication → Providers → Email (enable)
  3. Authentication → URL Configuration → Site URL = your Vercel domain
     Add Additional Redirect URLs: https://*.vercel.app, http://localhost:3000
  4. Enable Google OAuth provider, add callback:
     https://tqkixrssdwucgmgubbpm.supabase.co/auth/v1/callback
  -->
</body>
</html>
